# IO

## 一 IO基础

### 1.1 什么是BIO、NIO、AIO？

#### BIO 同步阻塞IO

客户端通过Socket向服务端发起请求，建立与服务端ServerSocke的连接，服务端处理完成后，进行响应，客户端会一直等待，直到服务端返回。

当有多个客户端同时发起请求时，服务端会分别创建一个线程进行处理。随着同时请求量变大，服务端创建线程数也会增大，会造成线程的不断切换，可能导致服务端崩溃。

服务端为了限制并发线程数无限制增大，可以采用线程池来管理分配线程，通过阻塞队列进行缓冲，避免同时大量请求，导致服务端崩溃。但是，这种方式会造成请求加入阻塞队列进行排队，导致响应慢。

#### NIO 同步非阻塞IO 

针对BIO，当多个客户端同时大量连接请求时，服务端会创建大量线程问题，进行了优化。

服务端使用一个线程多路复用选择器Selector来进行多个客户端请求的处理，当客户端与服务端建立连接后，Selector会为该客户端创建一个通道Channel，不同客户端会创建不同的Channel，这些Channel会注册到Selector上。Selector通过不断轮询多个Channel，当发现某个客户端对应的Channel存在请求时，会创建并启动线程，从Channel中读取请求内容进行处理，此时客户端会进行等待，处理完成后，通过Channel返回给客户端，线程消失。

线程可以通过线程池进行创建。

线程需要从Channel中读取写入数据，此时会存在一个缓冲Buffer，通过Buffer进行信息的传递。

**特点** 当客户端与服务端只是建立连接，此时创建Channel，只有客户端发送请求，才会创建线程进行处理，处理完成后线程消失，避免了长期维护线程。但是，当线程进行IO读写的时候，线程还是会持续等待完成，虽然线程会进行切换，仍需要不断取查看是否读写完成，AIO在该点又进行了优化，线程将读写操作交由操作系统去完成，不再需要主动去查看是否读写完成，而是读写完成后，操作系统会回调一个方法，通知线程进行后续处理。

同步，体现在线程会去定时查看是否读写完成，不能完全离开。

#### AIO 异步非阻塞IO

AIO针对NIO中，工作线程处理读写数据时，会同步等待处理完成问题，进行了优化。

工作线程在读写数据时，会提供给操作系统一个Buffer，当操作系统读写完成后，回调接口，对应方法再进行后续处理。

异步，体现在线程将读写操作交由操作系统完成，可以去干其它事情。

AIO使用当前不是很广泛，更多是NIO。



### 1.2 什么是同步阻塞？同步非阻塞？异步非阻塞？

> **同步：** 同步就是发起一个调用后，被调用者未处理完请求之前，调用不返回，需要不断取询问处理结果。
>
> **异步：** 异步就是发起一个调用后，立刻得到被调用者的回应表示已接收到请求，但是被调用者并没有返回结果，此时我们可以处理其他的请求，被调用者通常依靠事件，回调等机制来通知调用者其返回结果。
>
> **阻塞：** 阻塞就是发起一个请求，调用者一直等待请求结果返回，也就是当前线程会被挂起，无法从事其他任务，只有当条件就绪才能继续。
>
> **非阻塞：** 非阻塞就是发起一个请求，调用者不用一直等着结果返回，可以先去干其他事情。















